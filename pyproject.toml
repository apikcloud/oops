[build-system]
requires = ["hatchling", "hatch-vcs"]
build-backend = "hatchling.build"

[project]
name = "oops"
description = "Set of tools to help managing Odoo addons development"
readme = "README.md"
license = "AGPL-3.0-only"
authors = [{name = "Apik"}]
keywords = ["odoo", "git", "submodules", "manifests", "cli"]
dynamic = ["version"]
dependencies = [
    "appdirs",
    "docutils",
    "pypandoc",  # for oca-gen-addon-readme to work with markdown fragments
    "freezegun",
    "github3.py>=1",
    "manifestoo-core>=1.1",
    "PyYAML",
    "requests",
    "twine",
    "wheel",
    "pyproject_dependencies ; python_version>='3.7'",
    "setuptools-odoo",  # for oca-gen-external-dependencies
    "whool",  # for oca-gen-external-dependencies
    "typing-extensions; python_version<'3.11'",
    "importlib-metadata; python_version<'3.10'",
    "tomli; python_version<'3.11'", # from 3.11 tomllib is in stdlib
    "backports.zoneinfo; python_version<'3.9'",
    "click>=8.1",
    "typing-extensions>=4.7; python_version<'3.8'",
    "libcst==0.4.*; python_version<'3.8'",
    "rich>=13.0",  
    "fixit>2.0",  
    "black",
    "tabulate",
]


requires-python = ">=3.7"
classifiers = [
    "Development Status :: 4 - Beta",
    "Environment :: Console",
    "Intended Audience :: Developers",
    "Intended Audience :: Information Technology",
    "License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)",
    "Operating System :: POSIX :: Linux",
    "Programming Language :: Python",
]

[project.urls]
homepage = "https://github.com/apikcloud/oops"
repository = "https://github.com/apikcloud/oops"

[project.scripts]
# Main CLI
oops = "oops.__main__:main"

# Sub-commands
oops-addons-add = "oops.addons.add:main"
oops-addons-diff = "oops.addons.diff:main"
oops-addons-download = "oops.addons.download:main"
oops-addons-list = "oops.addons.list:main"
oops-addons-materialize = "oops.addons.materialize:main"
oops-addons-table = "oops.addons.gen_table:main"
oops-man-check = "oops.manifest.check:main"
oops-man-fix = "oops.manifest.fix:main"
oops-pro-check = "oops.project.check:main"
oops-pro-exclude = "oops.project.exclusions:main"
oops-pro-info = "oops.project.info:main"
oops-pro-update = "oops.project.update:main"
oops-sub-add = "oops.submodules.add:main"
oops-sub-check = "oops.submodules.check:main"
oops-sub-clean = "oops.submodules.clean:main"
oops-sub-flatten = "oops.submodules:flatten"
oops-sub-prune = "oops.submodules.prune:main"
oops-sub-rename = "oops.submodules.rename:main"
oops-sub-rewrite = "oops.submodules.rewrite:main"
oops-sub-show = "oops.submodules.show:main"
oops-sub-update = "oops.submodules.update:main"

[tool.hatch.build.targets.wheel]
packages = ["oops"]

[tool.hatch.metadata]
allow-direct-references = true

[tool.hatch.version]
source = "vcs"

[tool.ruff]
line-length = 100
target-version = "py38"
select = ["E","F","I","B","UP","SIM","PL","C90"]
ignore = [
  "E203", # whitespace before ':' (plays better with Black if you add it later)
]
exclude = ["tests/fixtures"]

[tool.pyright]
typeCheckingMode = "basic"
pythonVersion = "3.7"
reportMissingTypeStubs = false

[tool.pytest.ini_options]
addopts = "-q --strict-markers"
testpaths = ["tests"]

[tool.coverage.run]
source = ["oops"]
branch = true
parallel = true
omit = [
  "*/__main__.py",
  "*/_version.py",
  "*/tests/*",
]

[tool.coverage.report]
skip_empty = true
show_missing = true
fail_under = 80
exclude_lines = [
  "pragma: no cover",
  "if TYPE_CHECKING:",
  "if __name__ == .__main__.:",
  "raise NotImplementedError",
]

[tool.coverage.paths]
source = [
  "oops",
  ".venv/lib/python*/site-packages/oops",
]

[project.optional-dependencies]
dev = [
    "pytest",
    "pytest-cov",
    "coverage[toml]",
]